const currentUrl=window.location.href;let matched=currentUrl.match(/pages\/([^?]+)/);const module=matched[1].split("#")[0];let urlAfterPages="",cekUrl=currentUrl.split("?")[1]||null;urlAfterPages=cekUrl?currentUrl.substr(currentUrl.indexOf("?")+1):null,console.log(module),console.log(urlAfterPages);const Toast=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}});function submitForm(e){event.preventDefault();try{var t=document.querySelector("#"+e),r=new FormData(t),o=t.querySelector('[type="submit"]').value;r.append("csrf_token",document.querySelector("#csrf_token").value),r.append("url_awal",document.querySelector("#url_awal").value),r.append("submit",o),fetch("cek_login.php",{method:"POST",body:r}).then((async t=>{let r;t=await t.text(),console.log("Response dari server:",t);try{r=JSON.parse(t)}catch(t){throw new Error("Gagal memproses respons dari server (bukan JSON): "+t.message)}r.success?Toast.fire({icon:"success",title:"Berhasil",text:r.success}).then((()=>{switch(e){case"frmsignin":window.location.href="dashboard";break;case"frmsignup":window.location.href="https://suaracaleg.com";break;case"frmreset":window.location.href="confirm_reset"}})):Toast.fire({icon:"error",title:"Gagal",text:r.error||"Terjadi kesalahan saat login."})})).catch((e=>{console.error("Terjadi kesalahan:",e),Toast.fire({icon:"error",title:"Request Gagal",text:e.message||"Silakan coba lagi nanti."})}))}catch(t){console.error("Error saat submit:",t),Toast.fire({icon:"error",title:"Kesalahan",text:t.message||"Terjadi error tak terduga."})}}if("auth"==module&&(document.querySelectorAll("a[href^='#']").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault();let t=this.getAttribute("href").substr(1),r=document.querySelector("#frm"+t);document.querySelectorAll("a[href^='#']").forEach((function(e){e=e.getAttribute("href").substr(1);var o=document.querySelector("#frm"+e),n=document.querySelector(`.${e}-link`);r&&o&&(e===t?(o.classList.remove("d-none"),n.classList.add("d-none")):(o.classList.add("d-none"),n.classList.remove("d-none")))}))}))})),document.querySelectorAll(".reveal-password").forEach((function(e){e.addEventListener("click",(function(){var t=document.querySelector(e.dataset.target);"password"===t.getAttribute("type")?(t.setAttribute("type","text"),e.innerHTML='<i class="feather icon-eye-off"></i>'):(t.setAttribute("type","password"),e.innerHTML='<i class="feather icon-eye"></i>')}))})),document.querySelector("#frmsignin").addEventListener("submit",(function(){submitForm("frmsignin")})),document.querySelector("#frmsignup").addEventListener("submit",(function(){submitForm("frmsignup")})),document.querySelector("#frmreset").addEventListener("submit",(function(){submitForm("frmreset")}))),document.getElementById("restricted"))try{Toast.fire({icon:"error",title:"Unauthorized",text:"Maaf, Anda tidak berhak mengakses halaman ini"}).then((()=>{window.location.href="dashboard"}))}catch(e){console.error(e)}function showToast(e,t){Toast.fire({icon:e,title:t}).then((()=>{window.location.href=module}))}const notifSave=document.getElementById("notif_save"),notifError=document.getElementById("notif_error"),notifUploading=document.getElementById("notif_uploading");notifSave&&showToast("success",notifSave.innerHTML),notifError&&showToast("error",notifError.innerHTML),notifUploading&&showToast("info",notifUploading.innerHTML,3e3),"auth"!=module&&$("#table-"+module).DataTable({dom:"<'row'<'col-sm-1'l><'col-sm-5 p-t-20'B><'col-sm-6 text-end'f>><'row'<'col-sm-12'tr>><'row'<'col'i><'col'p>>",buttons:["copy","csv","excel","print"],initComplete:function(){$("#table-"+module).show()},processing:!0,serverSide:!0,ajax:{url:urlAfterPages?"json/index.php?module="+module+"&"+urlAfterPages:"json/index.php?module="+module,type:"POST",dataSrc:function(e){return isNaN(e.recordsTotal)&&(e.recordsTotal=0),e.data}},language:{processing:'<div class="text-center"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></div>'},stateSave:!0});